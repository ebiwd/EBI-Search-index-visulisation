function customStratify(e){var t,n=e.length,r={nodes:[],links:[]};for(t=0;n>t;t+=1){var o="to generate",a=0,i=0;switch(t){case 0:o="Genomes & metagenomes",a=50,i=20;break;case 1:o="Nucelotide sequences",a=50,i=20;break;case 2:o="Protein sequences",a=50,i=20;break;case 3:o="Macromolecular structures",a=500,i=20;break;case 4:o="Macromolecular structures",a=50,i=20;break;case 5:o="Gene expression",a=50,i=20;break;case 6:o="Molecular interactions",a=50,i=20;break;case 7:o="Reactions, pathways & diseases",a=10,i=10;break;case 8:o="Gene expression",a=50,i=20;break;case 9:o="Protein expression data",a=50,i=20;break;case 10:o="Enzymes",a=50,i=20;break;case 11:o="Literature",a=50,i=20;break;case 12:o="Samples & ontologies",a=50,i=20;break;case 13:o="EBI web",a=500,i=30}r.nodes.push({id:"parent-record-"+t,name:o,group:t,size:1,level:1,x:a,y:i});for(var s=0;s<e[t].subdomains.domain.length;s+=1){var c=e[t].subdomains.domain[s];if(void 0==c.subdomains){void 0==c["-description"]&&(c["-description"]=o);var l=c["-description"];r.nodes.push({id:l+"-"+t+"-"+s,name:l,group:t,size:c.indexInfos.indexInfo[0]["#text"],filesize:c.indexInfos.indexInfo[2]["#text"],level:2,x:a,y:i}),r.links.push({source:l+"-"+t+"-"+s,target:"parent-record-"+t,value:1})}else for(r.nodes.push({id:"parent-sub-record-"+t+"-"+s,name:c["-description"],group:t,size:100,level:2,x:a,y:i}),r.links.push({source:"parent-sub-record-"+t+"-"+s,target:"parent-record-"+t,value:1}),i3=0;i3<c.subdomains.domain.length;i3+=1){var d=c.subdomains.domain[i3];if(void 0==d.subdomains){void 0==d["-description"]&&(d["-description"]=o);var u=d["-description"];r.nodes.push({id:u+"-"+t+"-"+s+"-"+i3,name:u,group:t,size:d.indexInfos.indexInfo[0]["#text"],filesize:d.indexInfos.indexInfo[2]["#text"],level:3,x:a,y:i}),r.links.push({source:u+"-"+t+"-"+s+"-"+i3,target:"parent-sub-record-"+t+"-"+s,value:1})}else for(r.nodes.push({id:"parent-sub-record-"+t+"-"+s+"-"+i3,name:d["-description"],group:t,size:100,level:4,x:a,y:i}),r.links.push({source:"parent-sub-record-"+t+"-"+s+"-"+i3,target:"parent-record-"+t,value:1}),i4=0;i4<d.subdomains.domain.length;i4+=1){var f=d.subdomains.domain[i4];if(void 0!=f)if(void 0==f.subdomains){if(void 0!=f["-description"])var p=f["-description"];else var p=" ";r.nodes.push({id:p+"-"+t+"-"+s+"-"+i3+"-"+i4,name:p,group:t,size:f.indexInfos.indexInfo[0]["#text"],level:4,x:a,y:i}),r.links.push({source:p+"-"+t+"-"+s+"-"+i3+"-"+i4,target:"parent-sub-record-"+t+"-"+s+"-"+i3,value:1})}else console.log(f)}}}}return r}var svg=d3.select("svg"),width=+svg.attr("width"),height=+svg.attr("height"),tau=2*Math.PI,color=d3.scaleOrdinal(d3.schemeCategory20),isIE11=!!window.MSInputMethodContext&&!!document.documentMode;if(!isIE11){svg.selectAll("*").remove(),d3.json("data.json",function(e,t){function n(){i.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),a.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),isIE11?c.attr("x",function(e){return e.x}).attr("y",function(e){return e.y}):makeAnnotations.annotations().forEach(function(e,t){e.position=s[t]})}if(e)throw e;t=customStratify(t.domains);var r=d3.transition().duration(750).ease(d3.easeLinear),o=d3.tip().attr("class","d3-tip").offset([-8,0]).direction(function(e,t){return e.x<580?"e":e.x>900?"w":"n"}).html(function(e){var t=Math.floor(e.size/1e4)/100;return t>.02?t+"M<br/>"+e.name:Math.floor(e.size/10)/100+"K<br/>"+e.name});svg.call(o);var a=svg.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("opacity",0).attr("stroke-width",function(e){return Math.sqrt(e.value)}),i=svg.append("g").attr("class","nodes").selectAll(".nodes").data(t.nodes).enter().append("g").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});i.append("circle").attr("r",function(e){return Math.sqrt(Math.sqrt(e.size/100))+0}).attr("fill",function(e){return"rgba(255,255,255,0.0)"}).attr("opacity",0).attr("stroke",function(e){return color(e.group)}).on("mouseover",o.show).on("mouseout",o.hide).on("mousedown",function(e){window.open("https://www.ebi.ac.uk/ebisearch/overview.ebi","_blank")}),window.collide=d3.bboxCollide(function(e){return[[e.offsetCornerX-5,e.offsetCornerY-10],[e.offsetCornerX+e.width+5,e.offsetCornerY+e.height+5]]}).strength(.5).iterations(1);var s=t.nodes.filter(function(e){return"1"==e.level});if(isIE11){window.makeAnnotations=d3.annotation();var c=svg.append("g").attr("class","ie11Labels").selectAll(".ie11Labels").data(t.nodes).enter().append("text").text(function(e){return 1==e.level?e.name:void 0}).attr("fill",function(e){return color(e.group)})}else window.makeAnnotations=d3.annotation().type(d3.annotationLabel).annotations(s.map(function(e,t){return{data:{x:e.x,y:e.y,group:e.group},note:{label:e.name},subject:{radius:50,radiusPadding:10},className:"group-"+e.group}})).accessors({x:function(e){return e.x},y:function(e){return e.y}});svg.append("g").attr("opacity",0).attr("class","annotation-group").call(makeAnnotations);var l=d3.forceSimulation(t.nodes).velocityDecay(.1).alphaDecay(.1).alpha(1).force("x",d3.forceX().strength(.038)).force("y",d3.forceY().strength(.238)).force("link",d3.forceLink().id(function(e){return e.id}).distance(200).strength(1)).force("collide",d3.forceCollide().radius(function(e){return Math.sqrt(Math.sqrt(e.size/100))+1}).strength(1).iterations(10)).force("center",d3.forceCenter(width/1.7,height/2.3)).on("tick",n).on("end",function(){var e=makeAnnotations.collection().noteNodes;window.labelForce=d3.forceSimulation(e).force("x",d3.forceX(function(e){return e.positionX}).strength(function(e){return Math.max(.25,Math.min(3,Math.abs(e.x-e.positionX)/20))})).force("y",d3.forceY(function(e){return e.positionY}).strength(function(e){return Math.max(.25,Math.min(3,Math.abs(e.x-e.positionX)/20))})).force("collision",window.collide).alpha(.5).on("tick",function(t){makeAnnotations.annotations().forEach(function(t,n){var r=e[n];t.dx=r.x-r.positionX,t.dy=r.y-r.positionY})})});l.force("link").links(t.links).distance(10),d3.selectAll("circle").transition(r).delay(1e3).attr("opacity",1),d3.selectAll(".legendSize").transition(r).delay(1900).attr("opacity",.5),d3.selectAll(".annotation-group").transition(r).delay(function(e){return 2e3*Math.random()+2e3}).attr("opacity",1)});var linearSize=d3.scalePow().exponent(.19).domain([0,8e7]).range([1,25]);svg.append("g").attr("class","legendSize").attr("stroke","#fff").attr("fill","#000").attr("transform","translate("+(width-250)+", "+(height-150)+")");var legendSize=d3.legendSize().scale(linearSize).shape("circle").shapePadding(2).labelFormat(".0s").cells(5).title("Millions of entries in each domain").labelOffset(15).orient("horizontal");svg.select(".legendSize").attr("opacity","0").call(legendSize),svg.select(".legendSize text.legendTitle").attr("transform",function(e){return"translate(0,-10)"}).call(legendSize)}
